<html>
  <head>

  </head>
  <body>
    <div>
      <button onclick="send()">
        자동 재생 시작
      </button>
    </div>
    <script>
      var VIDEO_TIMEOUT = 240000;
      var MAX_VIDEO_OFFSET = 25;
      var MAX_PAGE_OFFSET = 25;

      function send() {
        var httpRequest = new XMLHttpRequest();
        function reqListener () {
          if (httpRequest.readyState == 4) {
            if (httpRequest.status == 200) {
              var videoLink = httpRequest.responseText;
              var openedWindow = window.open(videoLink, '_parent');
              openedWindow.addEventListener('load', function() {
                console.log("BBB");
                var video = document.getElementsByTagName('video')[0];

                video.onended = function(e) {
                  console.log("AAA");
                };
              }, false)
              // setTimeout(() => {
              //   openedWindow.close();
              //   getUrl();
              // }, VIDEO_TIMEOUT);
            } else { 
              alert("실패: " + httpRequest.status);
            }
          }
        }

        function getUrl() {
          httpRequest.onreadystatechange = reqListener;
          httpRequest.open("GET", "http://localhost:8080/api/autoplay");
          httpRequest.send();
        }
        getUrl();
      }
    </script>
  </body>
</html>